<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Hedley documentation">
    <meta name="author" content="Evan Nemerson">

    <title>Hedley User Guide</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.css"
	  integrity="sha384-12jyvLdRujy7xPBSEsRChlYNcKKODOnVcrqexeULMkmGGzBmM9ms6CT1HGxtu96M" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.6/darkly/bootstrap.min.css"
	  integrity="sha384-kVo/Eh0sv7ZdiwZK32nRsp1FrDT3sLRLx3zVpSSTI9UdO5H02LJNLBg5F1gwvKg0" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css"
	  integrity="sha384-22yWQUsKxP06m9aMT+5delmNhTmk7UDUOA4iNcZ8YI7XvkfzNqxbU8/OuFLdhbnx" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"
	    integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&amp;skin=desert" defer
	    integrity="sha384-Wy6yBc5mOi+pD3L2F//P7hAMCFxd+BuH2N75+ON4LvKDlmiggQn4Qaycythht5Xd" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js" defer
	    integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"
	    integrity="sha384-RPXhaTf22QktT8KTwZ6bUz/C+7CnccaIw5W/y/t0FW5WSDGj3wc3YtRIJC0w47in" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"
	    integrity="sha384-HwX0n9BiVutdIP0m3jKYarATBrBQMARe4JqN2bNN+eqbEirLWcklhaZgkovSBfc+" crossorigin="anonymous"></script>
    <![endif]-->
  </head>

  <body>
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Hedley</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="user-guide.html">User Guide</a></li>
            <li><a href="api-reference.html">API Reference</a></li>
            <li><a href="https://github.com/nemequ/hedley/issues">Support</a></li>
          </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="https://github.com/nemequ/hedley"><i class="fa fa-lg fa-github"></i> GitHub</a></li>
        </ul>
        </div>
      </div>
    </nav>

    <section class="container">
      <h1>Introduction</h1>

      <blockquote>
	<p>
	  If all you have is a hammer, everything looks like a nail.
	  If your hammer is C++, everything looks like your thumb.
	</p>
      </blockquote>

      <p>
	I don't know who said it first, but this humorous perversion
	of <a href="https://en.wikipedia.org/wiki/Law_of_the_instrument">the
	law of the instrument</a> has, in several variations, been
	floating around the internet for ages.  While it is probably
	more true of C++, the same can certainly be said of C.
      </p>

      <p>
	C, like C++, gives the programmer a huge amount of control
	over what the computer actually does.  While this makes it
	relatively easy to write efficient code, it also make it
	relatively easy to write code which crashes.  Higher level
	lanuages can often provide descriptive error messages at
	run-time, but with C and C++, there is often a single run-time
	error message: <q>Segmentation fault (core dumped)</q>, and
	that's if you get lucky enough to actually see an error
	message!  Often, the program can keep running, but generate
	garbage data or, even worse data which is just slightly
	incorrect (which is much harder to spot).
      </p>

      <p>
	To make up for the lack of run-time errors, compilers and
	static analyzers instead try to generate <em>compile</em>-time
	errors.  With a few simple annotations, you can give compilers
	and static analyzers a more information about how your program
	is supposed to work, which means they have a better chance of
	telling you when you make a mistake.
      </p>

      <p>
	Of course, it's not all about the errors… giving the compiler
	more information about your program also means it can do a
	better job of optimizing for you.
      </p>

      <p>
	Unfortunately, these annotations don't work everywhere.
	Different compilers and static analyzers support different
	annotations, which is where Hedley comes in.  Hedley uses the
	preprocessor to determine which annotations will work and
	which won't.  Annotations which work are defined to the
	compiler-specific version, while unsupported annotations will
	be defined away.
      </p>
    </section>

    <section class="container">
      <h1>Getting Started</h1>

      <p>
	Hedley is a single header file; to use it, just include it:
      </p>

      <pre class="prettyprint">#include "hedley.h"</pre>

      <p>
	And you're ready to go!
      </p>

      <h2>First Annotation: <code>HEDLEY_NON_NULL</code></h2>

      <p>
	First, let's look at a pretty straightforward function:
      </p>

      <pre class="prettyprint">#include "hedley.h"
#include &lt;stdio.h&gt;

struct Context {
  char* name;
};

void
print_message(struct Context* ctx, const char* message) {
  printf(&quot;%s: %s\n&quot;, ctx->name, message);
}</pre>

      <p>
	Here we just print out a message, but this is a very common
	pattern for lots of things: we take a pointer to a context,
	plus some additional argument(s), and do something with the
	fields of the context and the arguments.  You see this
	everywhere.
      </p>

      <p>
	Now, what happens if we call it with <var>NULL</var> for the
	context?
      </p>

      <pre class="console">$ gcc -g -Wall -Werror test.c
$ ./a.out
Segmentation fault (core dumped)</pre>

      <p>
	Now, let's add a <code>HEDLEY_NON_NULL</code>
	attribute.  <code>HEDLEY_NON_NULL</code> lists paremeters
	which must never be <var>NULL</var>.  It accepts a variadic
	list of parameters identified by their integer offset (so in
	our example <var>ctx</var> is 0 and <var>message</var> is 1).
	While many C libraries can handle a <var>NULL</var> value for
	a string coversion specifier (%s), the standard doesn't
	mandate it, so we should make sure <em>both</em> parameters
	are non-<var>NULL</var>:
      </p>

      <pre class="prettyprint">#include "hedley.h"
#include &lt;stdio.h&gt;

struct Context {
  char* name;
};

HEDLEY_NON_NULL(1,2)
void
print_message(struct Context* ctx, const char* message) {
  printf(&quot;%s: %s\n&quot;, ctx->name, message);
}</pre>

      <p>
	Let's see what happens when we try to compile and run our call
	now:
      </p>

      <pre class="console">$ gcc -g -Wall -Werror test.c
<strong>test.c</strong>: In function ‘main’:
<strong>test.c:16:3</strong>: <span class="text-danger">error</span>: null argument where non-null required (argument 1) [<span class="text-danger">-Werror=nonnull</span>]
   <span class="text-danger">print_message</span>(NULL, &quot;Hello, world!&quot;);
   <span class="text-danger">^~~~~~~~~~~~~</span>
cc1: all warnings being treated as errors</pre>

      <p>
	Most compilers aren't <em>too</em> smart about this; you can
	“trick” them by assigning <var>NULL</var> to a variable then
	calling the function, but it's definitely better than nothing.
	Static analyzers, on the other hand, can find extremely
	convoluted cases where you may be passing <var>NULL</var>.
      </p>
    </section>

    <section class="container">
      <h1>How it Works</h1>

      <p>
	Hedley isn't magic, and we certainly didn't manage to convince
	compiler vendors to add support for our macros; Hedley simply
	uses the preprocessor to determine which compiler and version
	you are using, then either emits the compiler-specific snippet
	or, if there is no known implementation for the compiler,
	nothing at all.
      </p>

      <p>
	As an example, <code>HEDLEY_NON_NULL</code> uses
	GCC's <var>nonnull</var> function attribute where it is
	available (a lot of compilers pretend to be GCC, and implement
	it).  Other macros have different implementations on different
	platforms; for example, <code>HEDLEY_INLINE</code> is
	implemented as <code>inline</code> if you are compiling in C99
	or greater mode.  If not, there is the
	GNU <code>__inline__</code> extension on GCC-compatible
	compilers, or <code>__inline</code> for Microsoft Visual C++.
	Some features are also only enabled for certain versions of
	compilers; for example, <code>HEDLEY_FORCE_INLINE</code> maps
	to the <code>always_inline</code> attribute for GCC >=
	4.0.0, <code>__forceinline</code> for Visual C++ <= 12.0
	(Visual Studio 6.0), or <code>HEDLEY_INLINE</code> as a
	fallback.
      </p>
    </section>

    <footer>
      <div class="well">
        <p>
          Created by <a href="https://evan.nemerson.com/">Evan Nemerson</a>.
        </p>

        <p>
          Code licensed under <a href="https://opensource.org/licenses/MIT">The MIT License</a>.
        </p>

        <p>
          Web site based
          on <a href="http://getbootstrap.com">Bootstrap</a>, using
          the “Darkly” theme
          from <a href="https://bootswatch.com/">Bootswatch</a>.
        </p>
      </div>

    </footer>
  </body>
</html>
